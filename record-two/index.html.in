<!DOCTYPE html>
<html ng-app="chaise.record">
<head>
    <title>Record</title>
    <meta http-equiv="X-UA-Compatible" content="IE=10; IE=9; IE=8; IE=7; IE=EDGE" />
    %ASSETS%
</head>
<body>
    <navbar></navbar>

    <div class="container-fluid">
        <div id="record2-bookmark-container" class="col-xs-12 meta-icons" ng-controller="RecordController as ctrl">
            <a id="create-record" ng-if="reference && reference.canCreate && ctrl.modifyRecord" title="Click here to create a record" ng-click="::ctrl.createRecord()">
                <span class="glyphicon glyphicon-plus"></span> <strong>Create Record</strong>
            </a>&nbsp;&nbsp;
            <a id="edit-record" ng-if="reference && reference.canUpdate && ctrl.modifyRecord" title="Click here to edit this record" ng-click="::ctrl.editRecord()">
                <span class="glyphicon glyphicon-pencil"></span> <strong>Edit Record</strong>
            </a>&nbsp;&nbsp;
            <a id="permalink" title="This link stores your search criteria as a URL. Right click and save." ng-href="{{ctrl.permalink()}}">
                <span class="glyphicon glyphicon-bookmark"></span> <strong>Permalink</strong>
            </a>
        </div>

        <div ng-if="reference">
            <div id="entity-title">{{ recordDisplayname }}</div>
            <div id="entity-subtitle">{{ reference.displayname }}</div>
        </div>

        <!-- defined on $rootScope in run function -->
        <div ng-if="recordValues && columns">
            <record-display columns="columns" values="recordValues"></record-display>
        </div>

        <uib-accordion close-others="false">
            <div uib-accordion-group class="related-table-heading" id="rt-heading-{{relatedRef.displayname}}" ng-repeat="relatedRef in relatedReferences track by $index"
                ng-if="($index === 0 || tableModels[$index-1].hasLoaded) && tableModels[$index].rowValues.length > 0"
                heading="{{tableModels[$index].open ? '-' : '+'}} {{relatedRef.displayname}} ({{tableModels[$index].rowValues.length}})" is-open="tableModels[$index].open">
                <!-- for different elements inside the accordion -->
                <div ng-switch on="relatedRef.display.type">
                    <a class="more-results-link text-right" ng-controller="RecordController as ctrl" ng-click="ctrl.toRecordSet(relatedRef)">View All Records</a>
                    <div ng-switch-when="markdown">
                        <span ng-bind-html="page.content"></span>
                    </div>
                    <!-- ng-switch-when="table" is also the default case -->
                    <div ng-switch-default>
                        <record-table class="related-table" id="rt-{{relatedRef.displayname}}" vm="tableModels[$index]"></record-table>
                    </div>
                </div>
            </div>
        </uib-accordion>
    </div>
</body>
