<!DOCTYPE html>
<html ng-app="chaise.record">
<head>
    <title>Record</title>
    <meta http-equiv="X-UA-Compatible" content="IE=10; IE=9; IE=8; IE=7; IE=EDGE" />
    %ASSETS%
</head>
<body>
    <navbar></navbar>

    <div id="main-content" class="container-fluid">
        <div ng-controller="RecordController as ctrl">
            <div id="record-bookmark-container" class="col-xs-12 meta-icons">
                <a id="create-record" class="coltooltip" ng-click="::ctrl.createRecord()" ng-if="reference && reference.canCreate && ctrl.modifyRecord">
                    <span class="glyphicon glyphicon-plus"></span> <strong>Create</strong>
                    <span class="coltooltiptext">Click here to create a record</span>
                </a>&nbsp;&nbsp;
                <a id="edit-record" class="coltooltip" ng-click="::ctrl.editRecord()" ng-if="reference && reference.canUpdate && ctrl.modifyRecord">
                    <span class="glyphicon glyphicon-pencil"></span> <strong>Edit</strong>
                    <span class="coltooltiptext">Click here to edit this record</span>
                </a>&nbsp;&nbsp;
                <delete-link id="delete-record" ng-if="reference && reference.canDelete && ctrl.modifyRecord && ctrl.showDeleteButton" label="Delete" tooltip="Click here to delete this record" icon="true" callback="ctrl.deleteRecord()"></delete-link>&nbsp;&nbsp;
                <a id="show-all-related-tables" class="coltooltip" ng-click="ctrl.toggleRelatedTables();">
                    <span class="glyphicon" ng-class="{'glyphicon-resize-full': !ctrl.showEmptyRelatedTables, 'glyphicon-resize-small': ctrl.showEmptyRelatedTables}"></span>
                    <strong>
                        <span ng-show="!ctrl.showEmptyRelatedTables">Show All</span>
                        <span ng-show="ctrl.showEmptyRelatedTables">Hide Empty</span>
                         Related Records
                    </strong>
                    <span class="coltooltiptext">Click here to show empty related entities too.</span>
                </a>&nbsp;&nbsp;
                <a id="permalink" class="coltooltip" ng-href="{{ctrl.permalink()}}">
                    <span class="glyphicon glyphicon-bookmark"></span><strong> Permalink</strong>
                    <span class="coltooltiptext">This link stores your search criteria as a URL. Right click and save.</span>
                </a>
            </div>
            <alerts alerts="ctrl.alerts"></alerts>

            <div ng-if="reference">
                <div id="entity-title" ng-bind-html="recordDisplayname"></div>
                <div id="entity-subtitle">{{ reference.displayname }}</div>
            </div>

            <!-- defined on $rootScope in run function -->
            <div ng-if="recordValues && columns">
                <record-display columns="columns" values="recordValues"></record-display>
            </div>

            <uib-accordion close-others="false">
                <div uib-accordion-group class="related-table-heading" id="rt-heading-{{relatedRef.displayname}}" ng-repeat="relatedRef in relatedReferences track by $index" ng-if="ctrl.showRelatedTable($index)"
                    heading="{{tableModels[$index].open ? '-' : '+'}} {{relatedRef.displayname}} ({{tableModels[$index].rowValues.length}})" is-open="tableModels[$index].open">
                    <!-- for different elements inside the accordion -->
                    <div ng-switch on="relatedRef.display.type">
                        <div class="row">
                            <div class="col-xs-12 text-right">
                                <span ng-if="relatedRef.canCreate && ctrl.modifyRecord"><a class="add-records-link" ng-click="ctrl.addRelatedRecord(relatedRef)">Add</a> |</span>
                                <a class="more-results-link" ng-click="ctrl.toRecordSet(relatedRef)">View All</a>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-12">
                                <div ng-switch-when="markdown">
                                    <span class="markdown-container" bind-html-unsafe="tableModels[$index].page.content"></span>
                                </div>
                                <!-- ng-switch-when="table" is also the default case -->
                                <div ng-switch-default>
                                    <record-table class="related-table" id="rt-{{relatedRef.displayname}}" vm="tableModels[$index]" default-row-linking="true"></record-table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </uib-accordion>
            <span ng-show="loading">Loading...</span>
        </div>
    </div>
</body>
